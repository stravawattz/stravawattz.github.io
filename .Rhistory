# Clean global environment except for base data
#rm(list=setdiff(ls(), c("df_all_distinct", "df_all")))
})
# Print message
cat("Packages and data are loaded\n")
suppressMessages({
# Load packages
suppressPackageStartupMessages({
library(dplyr)
library(jsonlite)
library(httr)
library(ggplot2)
library(stringr)
library(tidyr)
library(purrr)
library(lubridate)
library(leaflet)
library(DT)
library(plotly)
library(openmeteo)
library(RColorBrewer)
library(clipr)
library(scales)
library(reshape2)
library(sf)
})
# Prepare global environment
#rm(list = ls(all = TRUE))
# Determine first and last year of data
first_year_of_the_dasboard <- 2023
last_year_of_the_dasboard <- year(Sys.Date())
# Determine personal hr parameters
personal_max_hr <- 188
personal_rest_hr <- 64
hr1 <- 120
hr2 <- 138
hr3 <- 150
hr4 <- 162
hr5 <- 174
# Set WD
setwd("/Users/emmanueldockx/Dropbox/GitHub/stravawattz.github.io")
# Load existing data
#load("stravawattz.RData")
# Clean global environment except for base data
#rm(list=setdiff(ls(), c("df_all_distinct", "df_all")))
# Print message
cat("Packages and data are loaded\n")
})
suppressMessages({
# Load packages
suppressPackageStartupMessages({
library(dplyr)
library(jsonlite)
library(httr)
library(ggplot2)
library(stringr)
library(tidyr)
library(purrr)
library(lubridate)
library(leaflet)
library(DT)
library(plotly)
library(openmeteo)
library(RColorBrewer)
library(clipr)
library(scales)
library(reshape2)
library(sf)
})
# Prepare global environment
#rm(list = ls(all = TRUE))
# Determine first and last year of data
first_year_of_the_dasboard <- 2023
last_year_of_the_dasboard <- year(Sys.Date())
# Determine personal hr parameters
personal_max_hr <- 188
personal_rest_hr <- 64
hr1 <- 120
hr2 <- 138
hr3 <- 150
hr4 <- 162
hr5 <- 174
# Set WD
setwd("/Users/emmanueldockx/Dropbox/GitHub/stravawattz.github.io")
# Load existing data
#load("stravawattz.RData")
# Clean global environment except for base data
#rm(list=setdiff(ls(), c("df_all_distinct", "df_all")))
# Print message
cat("Packages and data are loaded\n")
})
df <- df_all_distinct_tload
target_year <- 2025
metric <- "all"
# Temporary mutation
df <- df %>% mutate(type = ifelse(type == "Rest", "Run", type)) %>% #mutate(type = paste0(type, " TRIMP")) %>%
filter(date >= as.Date(paste0(target_year, "-01-01")) & date <= as.Date(ifelse(target_year == year(Sys.Date()), Sys.Date()+7, paste0(target_year, "-12-31"))))
# Define color map for activity type
type_colors <- c("Run" = "#00bc8c", "Ride" = "#f5a623", "Swim" = "#2e86de")
# TRIMP name
trimp_name <- df$type
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the ACWR values
plot_second <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ACWR,
name = "ACWR",
line = list(color = "#f1c40f", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ACWR: ", formatC(ACWR, format = "f", digits = 2)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, color = "white", title = "ACWR", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the TRIMP values
plot_trimp <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_bars(y = ~TRIMP,
name = ~type,
type = 'bar',
color = ~type,
colors = type_colors,
text = ~paste0("<b>", toupper(sub(" TRIMP", "", type)), "</b><br>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "<br>TRIMP: ", round(TRIMP, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(range = c(1, max(df$TRIMP, na.rm = TRUE)), zeroline = FALSE, fixedrange = TRUE, color = "white", title = "TRIMP\n", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Combine vertically
subplot(plot_main, plot_second, plot_trimp, nrows = 3, shareX = TRUE, titleY = TRUE, heights = c(0.5, 0.25, 0.25), margin = 0.025) %>%
layout(paper_bgcolor = "#2d2d2d")
plot_main
as.Date(paste0(target_year, "-12-31")
as.Date(paste0(target_year, "-12-31"))
as.Date(paste0(target_year, "-12-31"))
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
add_trace(
contours = list(start = 1, end = 1, coloring = "none"),
x = as.character(hr_range),
y = duration_range,
z = acwr_matrix,
type = "contour",
line = list(color = rgb(1, 1, 1, 0.5), width = 1.0),
showscale = FALSE) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
add_trace(
contours = list(start = 1, end = 1, coloring = "none"),
x = as.character("hr_range"),
y = max(~ATL, na.rm = TRUE),
z = acwr_matrix,
type = "contour",
line = list(color = rgb(1, 1, 1, 0.5), width = 1.0),
showscale = FALSE) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
df
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
add_trace(
contours = list(start = 1, end = 1, coloring = "none"),
x = as.character("hr_range"),
y = max(df$ATL, na.rm = TRUE),
z = acwr_matrix,
type = "contour",
line = list(color = rgb(1, 1, 1, 0.5), width = 1.0),
showscale = FALSE) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
add_trace(
contours = list(start = 1, end = 1, coloring = "none"),
x = as.character("hr_range"),
y = max(df$ATL, na.rm = TRUE),
type = "contour",
line = list(color = rgb(1, 1, 1, 0.5), width = 1.0),
showscale = FALSE) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
plot_main
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 1, xref = "x", yref = "paper", line = list(color = "white", width = 1.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
plot_main
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 1, xref = "x", yref = "paper", line = list(color = "white", width = 0.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
plot_main
df <- df_all_distinct_tload
target_year <- 2025
metric <- "all"
# Temporary mutation
df <- df %>% mutate(type = ifelse(type == "Rest", "Run", type)) %>% #mutate(type = paste0(type, " TRIMP")) %>%
filter(date >= as.Date(paste0(target_year, "-01-01")) & date <= as.Date(ifelse(target_year == year(Sys.Date()), Sys.Date()+7, paste0(target_year, "-12-31"))))
# Define color map for activity type
type_colors <- c("Run" = "#00bc8c", "Ride" = "#f5a623", "Swim" = "#2e86de")
# TRIMP name
trimp_name <- df$type
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 1, xref = "x", yref = "paper", line = list(color = "white", width = 0.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the ACWR values
plot_second <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ACWR,
name = "ACWR",
line = list(color = "#f1c40f", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ACWR: ", formatC(ACWR, format = "f", digits = 2)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 1, xref = "x", yref = "paper", line = list(color = "white", width = 0.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, color = "white", title = "ACWR", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the TRIMP values
plot_trimp <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_bars(y = ~TRIMP,
name = ~type,
type = 'bar',
color = ~type,
colors = type_colors,
text = ~paste0("<b>", toupper(sub(" TRIMP", "", type)), "</b><br>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "<br>TRIMP: ", round(TRIMP, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 1, xref = "x", yref = "paper", line = list(color = "white", width = 0.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(range = c(1, max(df$TRIMP, na.rm = TRUE)), zeroline = FALSE, fixedrange = TRUE, color = "white", title = "TRIMP\n", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Combine vertically
subplot(plot_main, plot_second, plot_trimp, nrows = 3, shareX = TRUE, titleY = TRUE, heights = c(0.5, 0.25, 0.25), margin = 0.025) %>%
layout(paper_bgcolor = "#2d2d2d")
# Plot the ATL/CTL values
plot_main <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ATL,
name = "ATL",
line = list(color = "#e74c3c", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ATL: ", round(ATL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# CTLpct line  ── grey, width 2 ≈ size 1 in ggplot
add_lines(y = ~CTL,
name = "CTL",
line = list(color = "#9b59b6", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>CTL: ", round(CTL, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 0.8, xref = "x", yref = "paper", line = list(color = "white", width = 0.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, range = c(0, 1.15 * max(c(df$ATL, df$CTL), na.rm = TRUE)), color = "white", title = "ATL & CTL", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the ACWR values
plot_second <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_lines(y = ~ACWR,
name = "ACWR",
line = list(color = "#f1c40f", width = 2),
text = ~paste0("<b>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "</b><br>ACWR: ", formatC(ACWR, format = "f", digits = 2)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 1, xref = "x", yref = "paper", line = list(color = "white", width = 0.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(zeroline = FALSE, fixedrange = TRUE, color = "white", title = "ACWR", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Plot the TRIMP values
plot_trimp <- df %>% plot_ly(x = ~date) |>
# ATLpct line  ── black, width 2 ≈ size 1 in ggplot
add_bars(y = ~TRIMP,
name = ~type,
type = 'bar',
color = ~type,
colors = type_colors,
text = ~paste0("<b>", toupper(sub(" TRIMP", "", type)), "</b><br>", wday(date, label = TRUE, abbr = FALSE, week_start = 1), "<br>", format(as.Date(date), "%d/%m/%y"), "<br>TRIMP: ", round(TRIMP, 0)),
hoverinfo = 'text', textposition = "none", opacity = 0.97) |>
# Hide details
config(displayModeBar = FALSE, staticPlot = FALSE) |>
# Layout details
layout(
shapes = list(list(type = "line", x0 = Sys.Date(), x1 = Sys.Date(), y0 = 0, y1 = 1, xref = "x", yref = "paper", line = list(color = "white", width = 0.5, dash = "dot"))),
paper_bgcolor="#2d2d2d",
plot_bgcolor="#2d2d2d",
xaxis = list(zeroline = FALSE, fixedrange = TRUE, tickformat = "%b", tickvals = seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), ticktext = format(seq(as.Date(paste0(target_year, "-01-01")), as.Date(paste0(target_year, "-12-31")), by = "month"), "%b"), color = "white", title = NA, gridcolor = rgb(0,0,0,0), gridwidth = 0.25),
yaxis  = list(range = c(1, max(df$TRIMP, na.rm = TRUE)), zeroline = FALSE, fixedrange = TRUE, color = "white", title = "TRIMP\n", gridcolor = "#333", gridwidth = 0.25),
legend = list(orientation = "h", x = 0.05, y = 1, font = list(color = "white")),
margin = list(l = 0, r = 0, t = 0, b = 0)
)
# Combine vertically
subplot(plot_main, plot_second, plot_trimp, nrows = 3, shareX = TRUE, titleY = TRUE, heights = c(0.5, 0.25, 0.25), margin = 0.025) %>%
layout(paper_bgcolor = "#2d2d2d")
